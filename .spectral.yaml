extends:
  - spectral:oas

rules:
  mcp-alias-discovery-services:
    description: "OpenAPI must document /api/obs/discovery/services alias"
    message: "Missing paths./api/obs/discovery/services"
    given: "$"
    severity: error
    then:
      field: "paths./api/obs/discovery/services"
      function: truthy

  mcp-alias-discovery-schemas:
    description: "OpenAPI must document /api/obs/discovery/schemas alias"
    message: "Missing paths./api/obs/discovery/schemas"
    given: "$"
    severity: error
    then:
      field: "paths./api/obs/discovery/schemas"
      function: truthy

  mcp-alias-discovery-openapi:
    description: "OpenAPI must document /api/obs/discovery/openapi alias"
    message: "Missing paths./api/obs/discovery/openapi"
    given: "$"
    severity: error
    then:
      field: "paths./api/obs/discovery/openapi"
      function: truthy

  mcp-base-self-status:
    description: "OpenAPI must document /api/self-status (base alias)"
    message: "Missing paths./api/self-status"
    given: "$"
    severity: error
    then:
      field: "paths./api/self-status"
      function: truthy

  mcp-sse-path-present:
    description: "OpenAPI must document /api/events/stream"
    message: "Missing paths./api/events/stream"
    given: "$"
    severity: error
    then:
      field: "paths./api/events/stream"
      function: truthy

  mcp-observers-path-present:
    description: "OpenAPI must document /api/obs/projects/{id}/observers"
    message: "Missing paths./api/obs/projects/{id}/observers"
    given: "$"
    severity: warn
    then:
      field: "paths./api/obs/projects/{id}/observers"
      function: truthy

  mcp-observer-type-path-present:
    description: "OpenAPI must document /api/obs/projects/{id}/observer/{type}"
    message: "Missing paths./api/obs/projects/{id}/observer/{type}"
    given: "$"
    severity: warn
    then:
      field: "paths./api/obs/projects/{id}/observer/{type}"
      function: truthy
